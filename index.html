<!DOCTYPE html>

<html>

<head>
<title>Mapa Vinicunca</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta property="og:title" content="Mapa Vinicunca " />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="yilaa" />
<meta property="og:url" content="https://yilaa.github.io/rutacafejaen" />
<meta property="og:description" content="Mapa Vinicunca." />
<meta property="og:image" content="https://yilaa.github.io/rutacafejaen/img/mapafb.jpg" />
<link href="https://fonts.googleapis.com/css?family=Bree+Serif&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
<link rel="stylesheet" href="style.css" />

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script type="text/javascript" src="js/pistas.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
<script src="js/animation.js"></script>
</head>

<body>
<a class="creditos" href="http://www.turismotec.org" target="_blank">Diseñado por TurismoTec.org</a>
<div id='map'>
</div>
<script>

L.Map = L.Map.extend({
    openPopup: function(popup) {
        this._popup = popup;
        return this.addLayer(popup).fire('popupopen', {
            popup: this._popup
        });
    }
});

let Pueblos = new L.featureGroup()
let Trekking = new L.featureGroup()
let Arqueologia = new L.featureGroup()
let Escalada = new L.featureGroup()
let Montana = new L.featureGroup()

var map = L.map('map', {
    //zoom: 10,
    zoomControl: false,
    closePopupOnClick: false,
    layers: [Montana, Pueblos, Arqueologia, Escalada, Trekking]
});
map.createPane('labels');
// map.getPane('labels').style.zIndex = 500;
map.getPane('labels').style.pointerEvents = 'none';

var CartoDB_VoyagerNoLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://carto.com/attributions">CARTO</a>',
}).addTo(map);

var CartoDB_VoyagerOnlyLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://carto.com/attributions">CARTO</a>',
	pane: 'labels'
}).addTo(map);


// Zoom controls
L.control.zoom({
     position:'bottomright'
}).addTo(map);


//Mostrar la ruta

var popupVia = L.popup()
    .setLatLng([-13.60765,-71.74924])   
    .setContent('De Cusco a Vinicunca son 3 horas aprox. en auto')
    .openOn(map)

var Pistas = L.geoJson(mapavias, {
  style: function(feature) {
      return {color: "#2B877F"}; 
    },
  onEachFeature: function (feature,layer) {
    layer.bindPopup(popupVia,{autoClose:false, className:'popupvias', offset:[-20,130],
     maxWidth:120} )
    }
  }).addTo(map)

// //Bounds
map.fitBounds(Pistas.getBounds());

Pistas.snakeIn()
Pistas.on('snakeend',function(){
popupVia.openOn(map)
Vinicunca.openPopup()
})


// iconos

var montanaIcon = L.icon({
  iconUrl: 'img/montanas.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [0,-9]
})

var puebloIcon = L.icon({
  iconUrl: 'img/house.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [0,-9]
})

var monumentIcon = L.icon({
  iconUrl: 'img/monument.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [0,-9]
})

var trekIcon = L.icon({
  iconUrl: 'img/people.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [0,-9]
})

var escaladaIcon = L.icon({
  iconUrl: 'img/escalada.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [0,-9]
})



// Obtener datos del csv y agregarlos al mapa

function Lugar (lugar, tipo, descripcion, lon, lat, url) {
  this.lugar = lugar
  this.tipo = tipo
  this.descripcion= descripcion
  this.lon= lon
  this.lat= lat
  this.url = url
}

async function getData() {
  const response= await fetch('js/LugaresVinicunca.csv')
  const data = await response.text()
  const table = data.split('\n').slice(1)
  table.forEach(row => {
    const columns = row.split(',')
    const lugar = columns[0]
    const tipo = columns[1]
    const descripcion = columns[2]
    const lon = parseFloat(columns[3])
    const lat = parseFloat(columns[4])
    const url = columns[5]
    nuevoLugar = new Lugar(lugar, tipo, descripcion,lon,lat,url)
    var popup = L.popup()
    .setContent('<h3>'+ nuevoLugar.lugar +'</h3>' + '<br/>' + '<p>' + nuevoLugar.descripcion + 
     '</p>' + '<br/>' + '<a href="' + nuevoLugar.url + '">' + nuevoLugar.url )
    switch (nuevoLugar.tipo) {
      case 'pueblo': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: puebloIcon})
      .addTo(Pueblos).addTo(map).bindPopup(popup)
      break
      case 'montaña': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon:montanaIcon})
      .addTo(Montana).addTo(map).bindPopup(popup)
      case 'vinicunca': return Vinicunca = L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon:montanaIcon})
      .addTo(Montana).addTo(map).bindPopup(popup)
      break
      case 'arqueologia': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: monumentIcon})
      .addTo(Arqueologia).addTo(map).bindPopup(popup)
      break 
      case 'caminata': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: trekIcon})
      .addTo(Trekking).addTo(map).bindPopup(popup)
      break
      case 'escalada': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: escaladaIcon})
      .addTo(Escalada).addTo(map).bindPopup(popup)
      break
    }
    agregar()
    
  })
}

var lugares = []
function agregar() {
  lugares.push(nuevoLugar)
}

getData()
// Menú de opciones

var overlays= {
  "Pueblos": Pueblos,
  "Montañas": Montana,
  "Arqueología": Arqueologia,
  "Trekking": Trekking,
  "Escalada": Escalada
}

L.control.layers(null, overlays, {
  collapsed: false,
  position: 'topleft',
  }).addTo(map);

// Al click de un ícono

Pueblos.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Montana.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Trekking.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Escalada.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Arqueologia.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})


    
</script>


</body>

</html>
