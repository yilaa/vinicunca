<!DOCTYPE html>

<html>

<head>
<title>Mapa Vinicunca</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta property="og:title" content="Mapa Vinicunca " />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="yilaa" />
<meta property="og:url" content="https://yilaa.github.io/rutacafejaen" />
<meta property="og:description" content="Mapa Vinicunca." />
<meta property="og:image" content="https://yilaa.github.io/rutacafejaen/img/mapafb.jpg" />
<link href="https://fonts.googleapis.com/css?family=Bree+Serif&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
<link rel="stylesheet" href="style.css" />


<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script type="text/javascript" src="js/vias.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
</head>

<body>
  <!-- <div id="overlay">
    <div class='header'>
    <h2>Vinicunca</h2>
    <p>Descubre más allá de la Montaña Arcoiris.</p>
  </div>
    <a href="index.html" class="home">Inicio</a>
  </div> -->
<a class="creditos" href="http://www.turismotec.org" target="_blank">Diseñado por TurismoTec.org</a>
<div id='map'>
</div>
<script>

let Pueblos = new L.featureGroup()
let Trekking = new L.featureGroup()
let Arqueologia = new L.featureGroup()
let Escalada = new L.featureGroup()
let Montana = new L.featureGroup()

var map = L.map('map', {
    //zoom: 10,
    zoomControl: false,
    closePopupOnClick: false,
    layers: [Montana, Pueblos, Arqueologia, Escalada, Trekking]
});
map.createPane('labels');
// map.getPane('labels').style.zIndex = 500;
map.getPane('labels').style.pointerEvents = 'none';

var CartoDB_VoyagerNoLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://carto.com/attributions">CARTO</a>',
}).addTo(map);

var CartoDB_VoyagerOnlyLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://carto.com/attributions">CARTO</a>',
	pane: 'labels'
}).addTo(map);


// Zoom controls
L.control.zoom({
     position:'topright'
}).addTo(map);


//Mostrar la ruta

var Pistas = L.geoJson(mapavias, {
  filter: function(feature, layer) {
      if (feature.geometry.type === 'LineString')
        return true;
    },
  style: function(feature) {
      return {color: "#32a663"}; 
    },
  // pointToLayer: function (feature, latlng) {
  //   return L.circleMarker(latlng, punto).bindTooltip(feature.properties.name)
  //   }
}).addTo(map);

// iconos

var montanaIcon = L.icon({
  iconUrl: 'img/montanas.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  //popupAnchor: [-35,9]
})

var puebloIcon = L.icon({
  iconUrl: 'img/house.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [-30,2]
})

var monumentIcon = L.icon({
  iconUrl: 'img/monument.svg',
  iconSize: [24,24],
  iconAnchor: [12,12],
  //popupAnchor: [9,9]
})

var trekIcon = L.icon({
  iconUrl: 'img/people.svg',
  iconSize: [23,23],
  iconAnchor: [11.5,11.5],
  //popupAnchor: [-70,9]
})

var escaladaIcon = L.icon({
  iconUrl: 'img/escalada.svg',
  iconSize: [20,20],
  iconAnchor: [10,10],
  //popupAnchor: [-70,9]
})



// Obtener datos del csv y agregarlos al mapa

function Lugar (lugar, tipo, descripcion, lon, lat) {
  this.lugar = lugar
  this.tipo = tipo
  this.descripcion= descripcion
  this.lon= lon
  this.lat= lat
}

async function getData() {
  const response= await fetch('js/LugaresVinicunca.csv')
  const data = await response.text()
  const table = data.split('\n').slice(1)
  table.forEach(row => {
    const columns = row.split(',')
    const lugar = columns[0]
    const tipo = columns[1]
    const descripcion = columns[2]
    const lon = parseFloat(columns[3])
    const lat = parseFloat(columns[4])
    nuevoLugar = new Lugar(lugar, tipo, descripcion,lon,lat)
    var popup = L.popup()
    .setContent(nuevoLugar.lugar + '<br/>' + nuevoLugar.descripcion)
    switch (nuevoLugar.tipo) {
      case 'pueblo': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: puebloIcon})
      .addTo(Pueblos).addTo(map).bindPopup(popup)
      break
      case 'montaña': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon:montanaIcon})
      .addTo(Montana).addTo(map).bindPopup(popup)
      break
      case 'arqueologia': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: monumentIcon})
      .addTo(Arqueologia).addTo(map).bindPopup(popup)
      break 
      case 'caminata': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: trekIcon})
      .addTo(Trekking).addTo(map).bindPopup(popup)
      break
      case 'escalada': return L.marker([nuevoLugar.lat,nuevoLugar.lon],{icon: escaladaIcon})
      .addTo(Escalada).addTo(map).bindPopup(popup)
      break
    }
    agregar()
    
  })
}

var lugares = []
function agregar() {
  lugares.push(nuevoLugar)
}

getData()
// Menú de opciones

var overlays= {
  "Pueblos": Pueblos,
  "Montañas": Montana,
  "Arqueología": Arqueologia,
  "Trekking": Trekking,
  "Escalada": Escalada
}

L.control.layers(null, overlays, {
  collapsed: false,
  position: 'topleft',
  }).addTo(map);

// Al click de un ícono

Pueblos.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Montana.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Trekking.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Escalada.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})
Arqueologia.on('click', function (e) { 
  map.flyTo([e.latlng.lat,e.latlng.lng],13,{
              duration: 0.15})
})


//Bounds
map.fitBounds(Pistas.getBounds());
    
</script>


</body>

</html>
